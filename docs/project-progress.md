# The Host (숙주) - 프로젝트 진행 상황

> 최종 업데이트: 2025년 1월 3일

## 전체 진행률: ~77%

## 구현 완료된 기능 ✅

### 1. 인증 시스템
- [x] Google OAuth 로그인
- [x] JWT 토큰 기반 인증
- [x] 자동 로그인 (리프레시 토큰)
- [x] 닉네임 설정 및 중복 검사

### 2. 로비 시스템
- [x] 방 목록 실시간 업데이트
- [x] 방 생성/참가/나가기
- [x] 방장 권한 시스템
- [x] 플레이어 강퇴 기능
- [x] 봇 허용 설정 (UI만)

### 3. 게임 핵심 메커니즘
- [x] 턴 기반 시스템 (1-4턴: 60초, 5턴+: 90초)
- [x] 구역 시스템 (3-6개, 플레이어 수에 따라 자동 조정)
- [x] 플레이어 상태 관리 (alive/host/zombie/killed/infected)
- [x] 익명성 시스템 (동물 닉네임 20개)
- [x] 이동 시스템 (매 턴 다음 구역 선택)

### 4. 숙주 시스템
- [x] 무작위 숙주 선정
- [x] 2턴마다 1명 감염 가능
- [x] 감염 후 5턴 뒤 좀비 변이
- [x] 감염자 상태 숨김 (infected → alive 표시)
- [x] 좀비 명령 UI (부분 구현)

### 5. 아이템 시스템
- [x] 13종 아이템 정의
- [x] 가중치 기반 확률 지급
- [x] 매 턴 시작 시 자동 지급
- [x] 아이템 전달 기능 (2025.01.02 구현)
- [x] 인벤토리 UI

### 6. 채팅 시스템
- [x] 구역별 실시간 채팅
- [x] 시스템 메시지
- [x] 익명 닉네임 표시
- [x] 채팅 로그 유지

### 7. UI/UX
- [x] 반응형 디자인
- [x] 모바일 지원
- [x] 배경음악 시스템
- [x] 메시지박스 시스템
- [x] 로딩 스피너
- [x] 에러 핸들링
- [x] 게임 중 나가기 기능 (2025.01.03 구현)

### 8. 기술 인프라
- [x] NestJS 백엔드 구조
- [x] Socket.io 실시간 통신
- [x] Redis Pub/Sub
- [x] PM2 클러스터 모드
- [x] Docker 설정
- [x] Caddy 리버스 프록시

## 부분 구현된 기능 ⚠️

### 1. 봇 시스템
- [x] 방 설정에 봇 허용 옵션
- [x] 봇 플레이어 생성 (음수 ID)
- [ ] AI 로직 구현
- [ ] LLM 연동

### 2. 백신 시스템
- [x] 백신 재료 아이템 3종
- [x] 백신 아이템
- [ ] 재료 조합 로직
- [ ] 숙주에게 투여 메커니즘
- [ ] 승리 조건 처리

### 3. 좀비 추격 시스템
- [x] UI 버튼 (도주/은신/유인)
- [x] 좀비 타겟 설정 UI
- [ ] 서버 로직 구현
- [ ] 추격 결과 처리

### 4. 낙서 시스템
- [x] 스프레이, 지우개 아이템
- [x] 구역 메시지 저장 구조
- [ ] 낙서 작성 기능
- [ ] 낙서 열람 기능
- [ ] 낙서 지우기 기능

## 미구현 기능 ❌

### 1. 아이템 사용 기능
- [ ] 진단키트: 감염 여부 확인
- [ ] 응급치료제: 감염 치료
- [ ] 무전기: 1:1 통신
- [ ] 마이크: 전체 방송
- [ ] 가짜백신: 숙주 판별
- [ ] 덫: 이동 방해
- [ ] 연막탄: 추격 회피
- [ ] 철사: 좀비 처치

### 2. 게임 종료 조건
- [ ] 생존자 승리: 백신 투여 성공
- [ ] 좀비 승리: 모든 생존자 감염/사망
- [ ] 무승부: 20턴 경과
- [ ] 게임 결과 화면

### 3. 추가 기능
- [ ] 빠른 매칭 시스템
- [ ] 게임 통계/전적
- [ ] 랭킹 시스템
- [ ] 튜토리얼
- [ ] 음성 채팅

### 4. 봇 플레이어
- [ ] 기본 AI 행동 패턴
- [ ] LLM API 연동
- [ ] 난이도 조절
- [ ] 성격 부여 시스템

## 발견된 이슈 🐛

### 1. 코드 내 TODO
- `waitRoomStore.ts:110` - 봇 설정 API 백엔드 구현 필요

### 2. 타입 관련
- `PlayerStatus`와 `Survivor` 타입 불일치 (해결됨)
- `infected` 상태 타입 에러 (해결됨)

### 3. 버그
- 게임 시작 시 중복 메시지 (해결됨)
- 아이템 전달 시 roomId 누락 (해결됨)
- 게임 나가기 시 exitToLobby 에러 (해결됨)
- showMessageBox 타입 에러 (해결됨)

## 우선순위 작업 목록 📋

### Priority 1 (핵심 기능)
1. **백신 시스템 완성**
   - 재료 조합 메커니즘
   - 숙주 투여 로직
   - 승리 조건 처리

2. **게임 종료 조건**
   - 승리/패배 판정
   - 게임 결과 화면
   - 로비로 복귀

3. **아이템 사용 구현**
   - 진단키트, 응급치료제
   - 가짜백신 (숙주 판별)

### Priority 2 (게임플레이 향상)
1. **좀비 추격 시스템**
   - 도주/은신/유인 로직
   - 추격 결과 처리

2. **통신 아이템**
   - 무전기 1:1 통신
   - 마이크 전체 방송

3. **낙서 시스템**
   - 익명 메시지 작성
   - 구역별 낙서 열람

### Priority 3 (부가 기능)
1. **봇 플레이어**
   - 기본 AI 구현
   - LLM 연동 (선택)

2. **게임 통계**
   - 플레이 기록 저장
   - 승률 통계

3. **매칭 시스템**
   - 빠른 게임 참가

## 기술 부채 💳

1. **리팩토링 필요**
   - 일부 컴포넌트 크기 과대
   - 중복 코드 정리 필요
   - nicknameList 중앙화 완료 (2025.01.03)

2. **테스트 코드**
   - 유닛 테스트 미작성
   - E2E 테스트 미작성

3. **문서화**
   - API 문서 미작성
   - 게임 룰 상세 문서 필요

## 예상 완료 시점

현재 진행 속도 기준:
- **MVP (최소 기능)**: 2-3주
- **베타 버전**: 4-6주
- **정식 출시**: 8-10주

## 최근 구현 내역 (2025.01.03)

1. **게임 중 나가기 기능**
   - 사이드바 및 모바일 네비게이션에 나가기 버튼 추가
   - 플레이어 상태를 'killed'로 변경 후 로비로 이동
   - 다른 플레이어에게 시스템 메시지로 알림
   - 방이 비면 게임 데이터 자동 정리

2. **코드 개선**
   - `ANIMAL_NICKNAMES`를 `game.types.ts`로 중앙화
   - `gameActions.ts`에 공유 `exitGame` 함수 생성
   - `showMessageBox` 사용법 수정 (success 체크 방식)

3. **버그 수정**
   - 게임 나가기 시 `exitToLobby` 중복 호출 방지
   - 이미 로비에 있는 경우 에러 처리
   - socket room leave 누락 문제 해결

## 다음 단계 제안

1. **즉시 작업 (1주차)**
   - 백신 조합 및 투여 시스템
   - 게임 종료 조건 구현
   - 진단키트, 응급치료제 사용 기능

2. **단기 목표 (2-3주차)**
   - 좀비 추격 시스템 완성
   - 통신 아이템 구현
   - 기본 봇 AI

3. **중기 목표 (4-6주차)**
   - 낙서 시스템
   - 게임 통계
   - 매칭 시스템

## 결론

프로젝트는 견고한 기술 기반과 핵심 시스템이 잘 구현되어 있습니다. 하지만 게임의 핵심인 백신 시스템과 승리 조건이 미구현 상태로, 이 부분의 구현이 최우선 과제입니다. 

현재 상태로는 게임의 기본 플로우는 작동하지만, 실제 게임플레이가 완성되지 않은 상태입니다. 백신 시스템과 아이템 사용 기능을 구현하면 MVP로서 테스트 가능한 수준이 될 것으로 예상됩니다.