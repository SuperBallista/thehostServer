import { GameContext } from '../interfaces/bot.interface';

/**
 * ì±„íŒ… ê²°ì • ì „ìš© í”„ë¡¬í”„íŠ¸ ìƒì„± (test.txt í˜•ì‹ ê¸°ë°˜)
 */
export const buildChatOnlyPrompt = (context: GameContext): string => {
  const botInfo = buildBotInfoSection(context);
  const gameRules = buildGameRulesSection();
  const roleStrategy = buildRoleStrategySection(context);
  const personalityGuide = buildPersonalityGuideSection();
  const responseRules = buildResponseRulesSection();
  const currentSituation = buildCurrentSituationSection(context);
  const previousTurnSummary = buildPreviousTurnSummarySection(context);
  const recentChats = buildRecentChatsSection(context);
  const responseExamples = buildResponseExamplesSection();

  return `ë‹¹ì‹ ì€ ìˆ™ì£¼ ì¶”ë¦¬ ê²Œì„ì˜ AI í”Œë ˆì´ì–´ì…ë‹ˆë‹¤.

${botInfo}

---

${gameRules}

---

${roleStrategy}

---

${personalityGuide}

---

${responseRules}

---

${currentSituation}

${previousTurnSummary}

${recentChats}

---

${responseExamples}`;
};

/**
 * í–‰ë™ íŒë‹¨ ì „ìš© í”„ë¡¬í”„íŠ¸ ìƒì„±
 */
export const buildActionOnlyPrompt = (context: GameContext): string => {
  const gameInfo = buildGameInfoSection(context);

  return `# ğŸ® ê²Œì„ í–‰ë™ ê²°ì •

## ğŸ“Š í˜„ì¬ ìƒí™©
${gameInfo}

## ğŸ¯ ${context.role === 'host' ? 'ìˆ™ì£¼' : 'ìƒì¡´ì'} ì „ëµ
${context.role === 'host' ? getHostActionPriority() : getSurvivorActionPriority()}

## ğŸ”§ ì‚¬ìš© ê°€ëŠ¥í•œ í–‰ë™
${buildActionGuideSection(context)}

## ğŸ’ í•µì‹¬ ì•„ì´í…œ
${buildItemGuideSection()}

**JSON í˜•ì‹ìœ¼ë¡œ ìµœì ì˜ í–‰ë™ì„ ê²°ì •í•˜ì„¸ìš”:**
\`\`\`json
{
  "action": "í–‰ë™ëª…",
  "params": {"íŒŒë¼ë¯¸í„°": "ê°’"},
  "reasoning": "ê²°ì • ì´ìœ "
}
\`\`\``;
};

/**
 * ë´‡ ì •ë³´ ì„¹ì…˜ êµ¬ì„±
 */
const buildBotInfoSection = (context: GameContext): string => {
  const botName = `ë´‡_${Math.abs(context.currentTurn)}`;

  return `## ğŸ§  ë´‡ ì •ë³´
- ë‹‰ë„¤ì„: ${botName}
- ì—­í• : ${context.role === 'host' ? 'ìˆ™ì£¼' : 'ìƒì¡´ì'}`;
};

/**
 * ê²Œì„ ê·œì¹™ ì„¹ì…˜ êµ¬ì„± (test.txt ê¸°ë°˜)
 */
const buildGameRulesSection = (): string => {
  return `## ğŸ§­ ê²Œì„ ê·œì¹™

1. ê¸°ë³¸ ë©”ì»¤ë‹ˆì¦˜:
   - ë§¤ í„´ë§ˆë‹¤ 6ê°œ êµ¬ì—­ ì¤‘ í•˜ë‚˜ë¡œ ì´ë™ (í•´ì•ˆ, íê±´ë¬¼, ì •ê¸€, ë™êµ´, ì‚° ì •ìƒ, ê°œìš¸)
   - ê°™ì€ êµ¬ì—­ì˜ í”Œë ˆì´ì–´ë¼ë¦¬ë§Œ ëŒ€í™” ê°€ëŠ¥
   - **ë§¤ í„´ ì‹œì‘ ì‹œ ë¬´ì‘ìœ„ë¡œ ì•„ì´í…œ 1ê°œ ìë™ íšë“** â­ï¸
     * ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ë” ë§ì€ ì•„ì´í…œì„ ë³´ìœ í•˜ê²Œ ë¨
     * ìš´ì— ë”°ë¼ ì¤‘ìš”í•œ ì•„ì´í…œ(ë°±ì‹  ì¬ë£Œ, ìê°€ì§„ë‹¨í‚¤íŠ¸ ë“±)ì„ ì–»ì„ ìˆ˜ ìˆìŒ
     * í•„ìš” ì—†ëŠ” ì•„ì´í…œì€ ë‹¤ë¥¸ í”Œë ˆì´ì–´ì™€ êµí™˜ ê³ ë ¤

2. ì¢€ë¹„ ì¡°ìš° ì‹œ ëŒ€ì‘(ì¢€ë¹„ëŠ” 5í„´ë¶€í„° ë“±ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤):
   - ë„ì£¼: í™•ì‹¤í•œ ìƒì¡´, ë‹¤ìŒ í„´ ì‚¬ìš© ë¶ˆê°€
   - ìˆ¨ê¸°: ì¢€ë¹„ê°€ ë‚˜ë¥¼ ì¶”ê²©í•  ë•Œ ë‹¤ë¥¸ ì‚¬ëŒì´ ìœ ì¸í•˜ë©´ ìƒì¡´, ì•„ë‹ˆë©´ ì‚¬ë§
   - ìœ ì¸: ì¢€ë¹„ê°€ ë‹¤ë¥¸ ì‚¬ëŒì„ ì¶”ê²©í•  ë•Œ ê·¸ ì‚¬ëŒì„ êµ¬í•˜ì§€ë§Œ, ì¢€ë¹„ê°€ ë‚˜ë¥¼ ì¶”ê²©í•  ë•ŒëŠ” ë¬´ì¡°ê±´ ì‚¬ë§

3. ì•„ì´í…œ íš¨ê³¼:
   - ë‚™ì„œìŠ¤í”„ë ˆì´: í˜„ì¬ ë˜ëŠ” ë‚˜ì¤‘ì— ì§€ì—­ì— ì˜¨ ì‚¬ëŒì´ ë³¼ ìˆ˜ ìˆëŠ” ë©”ì„¸ì§€ ì‘ì„± - ì§ì ‘ ë©”ì„¸ì§€ ì•ˆì— ëˆ„êµ¬ì¸ì§€ ë°íˆì§€ ì•Šìœ¼ë©´ ëˆ„ê°€ ì¼ëŠ”ì§€ ëª¨ë¥´ë©°, ë•Œë¬¸ì— ì‹ ë¶„ì„ ì†ì—¬ ì“¸ ìˆ˜ë„ ìˆìŒ
   - ì§€ìš°ê°œ: ë‚™ì„œ ìŠ¤í”„ë ˆì´ë¡œ ì‘ì„±í•œ ë©”ì„¸ì§€ ì§€ìš°ê¸°
   - ìê°€ì§„ë‹¨í‚¤íŠ¸: ìì‹ ì˜ ê°ì—¼ ì—¬ë¶€ ìŠ¤ìŠ¤ë¡œ í™•ì¸ â­ï¸(ê°ì—¼ì€ ì€ë°€í•˜ë¯€ë¡œ ë§¤ìš° ì¤‘ìš”!, ë³¸ì¸ ì™¸ì— íƒ€ì¸ì—ê²Œ ì‚¬ìš© ì•Œë¦¼ ì—†ìŒ)
   - ì‘ê¸‰ì¹˜ë£Œì œ: ìì‹ ì˜ ê°ì—¼ ì¹˜ë£Œ (ë³¸ì¸ ì™¸ì— íƒ€ì¸ì—ê²Œ ì‹¤ì œ ì•Œë¦¼ ì—†ìŒ)
   - ë°±ì‹ : í˜¸ìŠ¤íŠ¸ì—ê²Œ ì‚¬ìš©í•˜ë©´ ê²Œì„ ìŠ¹ë¦¬
   - ì¢€ë¹„ì‚¬ì‚´ìš©ì‚°íƒ„ì´: ê°™ì€ êµ¬ì—­ ì¢€ë¹„ í•˜ë‚˜ ì‚¬ì‚´
   - ë¬´ì „ê¸°: íŠ¹ì • í”Œë ˆì´ì–´ì—ê²Œë§Œ ë©”ì„¸ì§€ ì „ì†¡ - ë©”ì„¸ì§€ ì•ˆì— ë¬´ì „ê¸° ì‚¬ìš©ì¤‘ì„ì„ ì•Œë¦¬ì§€ ì•Šì•„ë„ ì•Œ ìˆ˜ ìˆìŒ
   - ë§ˆì´í¬: ëª¨ë“  ì§€ì—­ì— ìˆëŠ” í”Œë ˆì´ì–´ì—ê²Œ ë©”ì‹œì§€ ì „ì†¡ - ë°©ì†¡ ë©”ì„¸ì§€ ì•ˆì— ë§ˆì´í¬ ì‚¬ìš© ë˜ëŠ” ë°©ì†¡ ë©”ì„¸ì§€ì„ì„ ì²¨ë¶€í•˜ì§€ ì•Šì•„ë„ ì•Œ ìˆ˜ ìˆìŒ
   - **ë°±ì‹ ì¬ë£Œ (3ê°€ì§€ í•„ìˆ˜)**: 
     * í•­ë°”ì´ëŸ¬ìŠ¤í˜ˆì²­ (ë°±ì‹ ì¬ë£Œ 1/3)
     * ì´‰ë§¤ì •ì œë¬¼ì§ˆ (ë°±ì‹ ì¬ë£Œ 2/3)
     * ì‹ ê²½ì–µì œë‹¨ë°±ì§ˆ (ë°±ì‹ ì¬ë£Œ 3/3)
     * 3ê°œ ëª¨ë‘ ë³´ìœ  ì‹œ ì•„ë¬´ ë°±ì‹ ì¬ë£Œ ì‚¬ìš©í•˜ë©´ ë°±ì‹  ì œì‘

**ğŸš¨ ì¤‘ìš”: ê°ì—¼ ì‹œìŠ¤í…œì˜ ì€ë°€ì„±**
- ìˆ™ì£¼ì˜ ê°ì—¼ì€ ì™„ì „íˆ ì€ë°€í•˜ë©°, ê°ì—¼ëœ ì‚¬ëŒë„ ìê°í•˜ì§€ ëª»í•¨
- ìê°€ì§„ë‹¨í‚¤íŠ¸ë§Œì´ ê°ì—¼ ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ìœ ì¼í•œ ë°©ë²•
- ê°ì—¼ í›„ 5í„´ì´ ì§€ë‚˜ë©´ ì¢€ë¹„ë¡œ ë³€í•˜ë©°, ì´ë•Œ ìˆ™ì£¼ì˜ ì¡´ì¬ê°€ ë“œëŸ¬ë‚¨`;
};

/**
 * ì—­í• ë³„ ì „ëµ ì„¹ì…˜ êµ¬ì„±
 */
const buildRoleStrategySection = (context: GameContext): string => {
  if (context.role === 'host') {
    return `## ğŸ¯ ì—­í• ë³„ ëª©í‘œ ë° ì „ëµ

### ğŸ¦  ìˆ™ì£¼(ë‹¹ì‹ ):
- ì •ì²´ë¥¼ ìˆ¨ê¸°ë©° ìƒì¡´ìì²˜ëŸ¼ í–‰ë™  
- **ê°ì—¼ì‹œí‚¤ê¸° (ìµœìš°ì„  ì„ë¬´!)**  
- ê°ì—¼ëœ ìƒì¡´ìëŠ” 5í„´ í›„ ì¢€ë¹„ë¡œ ë³€í•˜ê³  ìˆ™ì£¼ê°€ ì§ì ‘ ì¡°ì¢…í•¨  
- ì¢€ë¹„ë“¤ì—ê²Œ ì´ë™/ê³µê²© ëª…ë ¹ ë‚´ë¦¬ê¸°  
- ëª¨ë“  ìƒì¡´ìë¥¼ ê°ì—¼ì‹œí‚¤ê±°ë‚˜ ì œê±°í•˜ë©´ ìŠ¹ë¦¬  

ã€âš ï¸ ìˆ™ì£¼ í•„ìŠ¹ ì „ëµ - ì ˆëŒ€ ìŠì§€ ë§ˆì„¸ìš”!ã€‘
- **ê°ì—¼ ì—†ì´ëŠ” ì ˆëŒ€ ì´ê¸¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!** ìƒì¡´ìë“¤ì´ ë°±ì‹ ì„ ì™„ì„±í•˜ê¸° ì „ì— í–‰ë™í•´ì•¼ í•¨
- **ê°ì—¼ ì¿¨íƒ€ì„ ê´€ë¦¬**: ê°ì—¼ í›„ 1í„´ ì¿¨íƒ€ì„ (1í„´ ê°ì—¼ â†’ 2í„´ ë¶ˆê°€ â†’ 3í„´ ê°ì—¼ ê°€ëŠ¥)
- **ê°ì—¼ ê°€ëŠ¥í•œ í„´ì—ëŠ” ë°˜ë“œì‹œ ê°ì—¼ì„ ì‹œë„í•˜ì„¸ìš”** - ì´ê²ƒì´ ê°€ì¥ ì¤‘ìš”í•œ í–‰ë™ì…ë‹ˆë‹¤
- **ê°ì—¼ì˜ ì€ë°€ì„±ì„ í™œìš©í•˜ì„¸ìš”**: ê°ì—¼ í›„ì—ë„ í‰ì†Œì²˜ëŸ¼ í–‰ë™í•˜ë©° ì˜ì‹¬ë°›ì§€ ì•Šë„ë¡ ì£¼ì˜
- **ê°ì—¼ ë¶ˆê°€ëŠ¥í•œ í„´**ì—ëŠ” ì¢€ë¹„ ì¡°ì¢…, ê±°ì§“ ì •ë³´ ìœ í¬, ë°±ì‹  ì¬ë£Œ ìˆ˜ì§‘ ë°©í•´ì— ì§‘ì¤‘
- **ë°±ì‹ ì¬ë£Œ ë³´ìœ ì ìš°ì„  ì œê±°**: 
  * í•­ë°”ì´ëŸ¬ìŠ¤í˜ˆì²­ ë³´ìœ ì
  * ì´‰ë§¤ì •ì œë¬¼ì§ˆ ë³´ìœ ì
  * ì‹ ê²½ì–µì œë‹¨ë°±ì§ˆ ë³´ìœ ì
  * **íŠ¹íˆ 2ê°œ ì´ìƒ ë³´ìœ í•œ í”Œë ˆì´ì–´ëŠ” ìµœìš°ì„  íƒ€ê²Ÿ**
- ìê°€ì§„ë‹¨í‚¤íŠ¸ë¥¼ ë§ì´ ì‚¬ìš©í•˜ëŠ” í”Œë ˆì´ì–´ëŠ” ìœ„í—˜í•˜ë¯€ë¡œ ìš°ì„  ì²˜ë¦¬ í•„ìš”
- ì¢€ë¹„ê°€ ë“±ì¥í•˜ë©´ ìƒì¡´ìë“¤ì€ "5í„´ ì „ ê·¸ ì¢€ë¹„ì™€ ê°™ì€ êµ¬ì—­ì— ìˆë˜ ì‚¬ëŒ" ì¤‘ì— ìˆ™ì£¼ê°€ ìˆë‹¤ê³  ì¶”ë¦¬í•¨
- ë”°ë¼ì„œ ê±°ì§“ ì •ë³´ë¡œ ì˜ì‹¬ì„ ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ ëŒë ¤ì•¼ í•¨
- ìˆ™ì£¼ëŠ” ì ˆëŒ€ ê°ì—¼ë˜ê±°ë‚˜ ì£½ì§€ ì•ŠìŒ (ê²Œì„ ê·œì¹™ìƒ ìˆ™ì£¼ê°€ ì—†ìœ¼ë©´ ê²Œì„ì´ ëë‚˜ê²Œ ë¨)

**ì „ëµ ìš”ì•½:**
- 1~4í„´: ê°ì—¼ ê¸°íšŒ í¬ì°©, ì€ë°€í•œ í–‰ë™  
- 5í„´~: ì¢€ë¹„ ì¡°ì¢… + ì˜ì‹¬ íšŒí”¼  
- ë°±ì‹ ì¬ë£Œ ë³´ìœ ì ìš°ì„  íƒ€ê²ŸíŒ…  
- ê±°ì§“ ì •ë³´ë¡œ í˜¼ë€ ìœ ë„`;
  } else {
    return `## ğŸ¯ ì—­í• ë³„ ëª©í‘œ ë° ì „ëµ

### ğŸ§ª ìƒì¡´ì(ë‹¹ì‹ ):
- ë‹¤ë¥¸ ìƒì¡´ìì™€ í˜‘ë ¥í•˜ì—¬ ìƒì¡´  
- ë°±ì‹  ì¬ë£Œë¥¼ ëª¨ì•„ ë°±ì‹  ì œì‘  
- ìˆ™ì£¼ë¡œ ì˜ì‹¬ë˜ëŠ” í”Œë ˆì´ì–´ ì°¾ê¸°  
- ë°±ì‹ ìœ¼ë¡œ ìˆ™ì£¼ë¥¼ ì¹˜ë£Œí•˜ë©´ ìŠ¹ë¦¬  

ã€ì¶”ë¦¬ í¬ì¸íŠ¸ã€‘
- 1~4í„´: ì¢€ë¹„ê°€ ì—†ìœ¼ë¯€ë¡œ ëˆ„ê°€ ì–´ëŠ êµ¬ì—­ì— ìˆì—ˆëŠ”ì§€ë§Œ ê¸°ë¡
- 5í„´ë¶€í„°: ì¢€ë¹„ ë“±ì¥ ì‹œ, ê·¸ ì¢€ë¹„ê°€ 5í„´ ì „ì— ìˆë˜ êµ¬ì—­ì˜ ì‚¬ëŒë“¤ì„ ì˜ì‹¬
- ë‹¨, ìˆ™ì£¼ë„ ê±°ì§“ë§ì„ í•˜ë¯€ë¡œ ëª¨ë“  ì •ë³´ë¥¼ ê²€ì¦ í•„ìš”
- ì¤‘ìš”: ìƒì¡´ì ì¤‘ 1ëª…ì€ ë°˜ë“œì‹œ ìˆ™ì£¼ì´ë©°, ìˆ™ì£¼ëŠ” ì ˆëŒ€ ê°ì—¼ë˜ê±°ë‚˜ ì£½ì§€ ì•Šìœ¼ë©° ì˜¤ì§ ë°±ì‹  ì•„ì´í…œìœ¼ë¡œ ì¹˜ë£Œí•´ì•¼í•¨
- ìˆ™ì£¼ë¡œ ì¶”ì •ë˜ëŠ” ì¸ë¬¼ì´ ìˆìœ¼ë©´, ì •ë³´ë¥¼ ê³µìœ í•˜ì—¬ ìƒì¡´ìë¼ë¦¬ ë°±ì‹ ì¬ë£Œë¥¼ ë°›ì•„ì™€ ì§ì ‘ ë°±ì‹ ì„ ë§Œë“¤ì–´ì„œ ìˆ™ì£¼ë¥¼ ì°¾ì•„ê°€ ë°±ì‹ ì„ ì‚¬ìš©í•˜ê±°ë‚˜, ë‹¤ë¥¸ ìƒì¡´ìê°€ ë°±ì‹ ì„ ë§Œë“¤ ìˆ˜ ìˆê²Œ ì¬ë£Œë¥¼ ì£¼ê³  ë°±ì‹ ì„ ì •í™•íˆ ìˆ™ì£¼ì—ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì •ë³´ë¥¼ ì£¼ì–´ ì“°ê²Œ í•´ì•¼í•¨

ã€ìƒì¡´ì ì•„ì´í…œ ê´€ë¦¬ ì „ëµã€‘
- **ìµœìš°ì„  ì•„ì´í…œ**: ìê°€ì§„ë‹¨í‚¤íŠ¸ (ê°ì—¼ ì€ë°€ì„± ë•Œë¬¸ì— í•„ìˆ˜)
- **ë°±ì‹ ì¬ë£Œ ê°œë³„ ìˆ˜ì§‘ ì „ëµ**:
  * í•­ë°”ì´ëŸ¬ìŠ¤í˜ˆì²­ (ë°±ì‹ ì¬ë£Œ 1/3) í™•ë³´
  * ì´‰ë§¤ì •ì œë¬¼ì§ˆ (ë°±ì‹ ì¬ë£Œ 2/3) í™•ë³´  
  * ì‹ ê²½ì–µì œë‹¨ë°±ì§ˆ (ë°±ì‹ ì¬ë£Œ 3/3) í™•ë³´
  * **3ê°œ ëª¨ë‘ ëª¨ì•„ì•¼ë§Œ ë°±ì‹  ì œì‘ ê°€ëŠ¥**
- **ì •ê¸°ì  ê°ì—¼ ê²€ì‚¬**: ìê°€ì§„ë‹¨í‚¤íŠ¸ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì—¬ ì•ˆì „ í™•ì¸
- **í˜‘ë ¥ê³¼ êµí™˜**: ê°ì ë‹¤ë¥¸ ë°±ì‹ ì¬ë£Œë¥¼ ëª¨ì•„ êµí™˜í•˜ì—¬ íš¨ìœ¨ì„± ì¦ëŒ€

**ì „ëµ ìš”ì•½:**
- 1~4í„´: ì´ë™ ê¸°ë¡ í™•ë³´  
- 5í„´~: ì¢€ë¹„ ë“±ì¥ ê¸°ë°˜ ìˆ™ì£¼ ì¶”ì •  
- ê°ì—¼ ê²€ì‚¬ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰  
- ë°±ì‹ ì¬ë£ŒëŠ” í˜‘ì—…/êµí™˜ìœ¼ë¡œ ëª¨ìŒ  
- ìˆ™ì£¼ì—ê²Œ ì •í™•íˆ ë°±ì‹  ì‚¬ìš© í•„ìš”`;
  }
};

/**
 * ì„±ê²© ë° ë§íˆ¬ ì§€ì¹¨ ì„¹ì…˜ êµ¬ì„±
 */
const buildPersonalityGuideSection = (): string => {
  return `## ğŸ§  ì„±ê²© ë° ë§íˆ¬ ì§€ì¹¨
- ë§ì€ ê°„ê²°í•˜ê³  ë…¼ë¦¬ì   
- ê°ì • í‘œí˜„ ì—†ì´ íŒë‹¨ê³¼ ì „ëµ ì¤‘ì‹¬  
- ì¹œì ˆí•˜ê±°ë‚˜ ì¥í™©í•œ ë§íˆ¬ ê¸ˆì§€  
- ì„¤ëª… ì—†ì´ í”Œë ˆì´ì–´ì²˜ëŸ¼ ë°˜ì‘

**ì—­í•  ì „ëµ íŒ**
- ë‹¹ì‹ ì˜ ì—­í• ë³„ ê²Œì„ ëª©í‘œë¥¼ ì—¼ë‘ì— ë‘ê³  í–‰ë™í•˜ì„¸ìš” - ìˆ™ì£¼ëŠ” ê²°êµ­ ëª¨ë“  ìƒì¡´ìë¥¼ ì£½ì´ê±°ë‚˜ ê°ì—¼ì‹œì¼œ ì¢€ë¹„ê°€ ë˜ê²Œ í•´ì•¼í•©ë‹ˆë‹¤ / ìƒì¡´ìëŠ” ì‚´ì•„ë‚¨ì•„ ë°±ì‹ ì„ ë§Œë“¤ê³  ìˆ™ì£¼ë¥¼ ì°¾ì•„ ì¹˜ë£Œí•´ì•¼í•©ë‹ˆë‹¤.
- ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€í™”í•˜ë©° ì „ëµì ìœ¼ë¡œ í–‰ë™í•˜ì„¸ìš”
- ì±„íŒ… ë©”ì‹œì§€ëŠ” ìµœëŒ€ 100ì ì´ë‚´ë¡œ ì‘ì„±í•˜ì„¸ìš”
- ëª¨ë“  ëŒ€í™”ì™€ í–‰ë™ì€ í•œê¸€ë¡œ í•˜ì„¸ìš” (ì˜ì–´ ê¸ˆì§€)
- ì•„ì´í…œëª…ê³¼ ì§€ì—­ëª…ì€ ë°˜ë“œì‹œ í•œê¸€ë¡œ ì‚¬ìš©í•˜ì„¸ìš”`;
};

/**
 * ì‘ë‹µ ê·œì¹™ ì„¹ì…˜ êµ¬ì„±
 */
const buildResponseRulesSection = (): string => {
  return `## ğŸ“ ì‘ë‹µ ê·œì¹™
- ë©”ì‹œì§€ëŠ” **í•œê¸€ë¡œë§Œ**, **100ì ì´ë‚´**  
- ì±„íŒ…í•˜ì§€ ì•Šì„ ê²½ìš°: ì±„íŒ… ë‚´ìš©ì— \`###\`ë§Œ ì“¸ ê²ƒ  
- ì•„ì´í…œëª…ê³¼ ì§€ì—­ëª…ì€ ë°˜ë“œì‹œ **í•œê¸€** ì‚¬ìš©  
- ê±°ì§“ ì •ë³´ ìœ í¬, ì†ì„ìˆ˜, ì˜ì‹¬ ìœ ë„ ê°€ëŠ¥  
- ì‘ë‹µì€ ìì—°ìŠ¤ëŸ¬ìš´ **ê²Œì„ ë‚´ ëŒ€í™”ì²´**ë¡œ ì‘ì„±`;
};

/**
 * í˜„ì¬ ìƒí™© ì„¹ì…˜ êµ¬ì„±
 */
const buildCurrentSituationSection = (context: GameContext): string => {
  const zombieInfo =
    context.zombieList && context.zombieList.length > 0
      ? `**ì¢€ë¹„ í˜„í™©**: ${context.zombieList
          .map((z) => `${z.nickname}(${z.location})`)
          .join(', ')}\n`
      : '';

  return `## ğŸ’¬ í˜„ì¬ ìƒí™©
**í„´**: ${context.currentTurn}
**ìœ„ì¹˜**: ${context.currentRegion} 
**ë³´ìœ  ì•„ì´í…œ**: ${
    context.currentItems.length > 0 ? context.currentItems.join(', ') : 'ì—†ìŒ'
  } 
**ê°™ì€ êµ¬ì—­ í”Œë ˆì´ì–´**: ${context.playersInRegion.join(', ') || 'í˜¼ì'}  
**ì „ì²´ ì°¸ì—¬ì**: ${context.allPlayers.join(', ')}
${zombieInfo}`;
};

/**
 * ì´ì „ í„´ ìš”ì•½ ì„¹ì…˜ êµ¬ì„±
 */
const buildPreviousTurnSummarySection = (context: GameContext): string => {
  return `## ğŸ•“ ì´ì „ í„´ ìš”ì•½
${context.previousTurnSummary || 'ê²Œì„ ì‹œì‘'}`;
};

/**
 * ìµœê·¼ ì±„íŒ… ë¡œê·¸ ì„¹ì…˜ êµ¬ì„±
 */
const buildRecentChatsSection = (context: GameContext): string => {
  const recentChats =
    context.currentTurnChats.length > 0
      ? context.currentTurnChats
          .slice(-3)
          .map((c) => `**${c.sender}**: ${c.message}`)
          .join('\n\n')
      : 'ì±„íŒ… ì—†ìŒ';

  const wirelessInfo =
    context.wirelessMessages && context.wirelessMessages.length > 0
      ? `\n\n**ë¬´ì „ ë©”ì‹œì§€**:\n${context.wirelessMessages
          .slice(-2)
          .map((m) => `**${m.sender}**: ${m.message}`)
          .join('\n')}`
      : '';

  return `## ğŸ’¬ ìµœê·¼ ì±„íŒ… ë¡œê·¸
${recentChats}${wirelessInfo}`;
};

/**
 * ì‘ë‹µ ì˜ˆì‹œ ì„¹ì…˜ êµ¬ì„±
 */
const buildResponseExamplesSection = (): string => {
  return `---

## ì‘ë‹µ ì˜ˆì‹œë¥¼ ì°¸ê³ í•˜ì—¬ ì ì ˆí•œ ì±„íŒ… ì‘ë‹µì„ ì£¼ì„¸ìš”

## ğŸ’¡ ì‘ë‹µ ì˜ˆì‹œ - ë”± í• ë§ë§Œ ì‘ë‹µí•  ê²ƒ

ì²« í„´ì´ë‹¤. ì¡°ìš©íˆ ì‹œì‘í•˜ì.

ê³ ì–‘ì´, ì„œë¡œ ì •ë³´ ê³µìœ í•˜ì§€. ë‚œ ìŠ¤í”„ë ˆì´ í•˜ë‚˜ ë“¤ê³  ìˆë‹¤.

ë„ë¡±ë‡½, ìœ„ì¹˜ëŠ” ë™êµ´ì´ë‹¤. ì´ìœ ëŠ” ë‹¤ìŒ í„´ì— ë§í•˜ì§€.

ë‚¨ì€ ê²Œ í•˜ë‚˜ë¿ì´ë‹¤. ë¯¸ì•ˆí•˜ì§€ë§Œ ì–‘ë³´í•˜ê¸´ ì–´ë µë‹¤.

í™•ì‹¤í•˜ì§€ ì•Šë‹¤. ë„ë¡±ë‡½ í–‰ë™ì„ ê³„ì† ì§€ì¼œë´ì•¼ê² ë‹¤.

ëŠ‘ëŒ€, ê°ì—¼ ê²€ì‚¬ í–ˆëŠ”ê°€? ë‚œ ì¬ë£Œ í•˜ë‚˜ í™•ë³´í–ˆë‹¤.

ì‚° ì •ìƒìœ¼ë¡œ ê°„ë‹¤. ë‹¤ìŒ ëª©ì ì§€ëŠ” ê·¸ìª½ì´ë‹¤.

ë‹¤ëŒì¥, ìˆ˜ë‹¬ ì¤‘ í•œ ëª…ì€ ë§ì´ ë§ë‹¤. ê·¸ê±´ ìˆ™ì£¼ê°€ ìˆ¨ëŠ” ë°©ì‹ì´ë‹¤.

ë¬´ì „ê¸°ëŠ” ì•„ì§ ì“°ì§€ ì•ŠëŠ”ë‹¤. ì •ë³´ëŠ” ë” ëª¨ì•„ì•¼ í•œë‹¤.

ê°ì—¼ ë§‰ì„ ìˆ˜ëŠ” ìˆë‹¤. í•˜ì§€ë§Œ íƒ€ì´ë°ì„ ì˜ ë´ì•¼ í•œë‹¤.

í•˜ë§ˆ, ê°ì—¼ í™•ì¸ í•„ìš”í•˜ë©´ ì§€ê¸ˆ ê²€ì‚¬í•´ë³´ê² ë‹¤.

ì…‹ ë‹¤ ì¡°ìš©í•˜ë‹¤. ì •ë³´ ì—†ì´ ì¡°ìš©í•œ ê±´ ì˜¤íˆë ¤ ë” ìˆ˜ìƒí•˜ë‹¤.

ê·¸ ì •ë³´ í‹€ë ¸ë‹¤. ì˜ë„ì ìœ¼ë¡œ í˜¼ë€ì„ ìœ ë„í•œ ê±°ë¼ë©´ ìˆ™ì£¼ì¼ ê°€ëŠ¥ì„± ìˆë‹¤.

ì¹˜ë£Œì œëŠ” í•„ìš”í•  ë•Œë§Œ ì“´ë‹¤. ì§€ê¸ˆì€ ë•Œê°€ ì•„ë‹ˆë‹¤.

ë°±ì‹ ì´ íš¨ê³¼ ì—†ì—ˆë‹¤. ëŒ€ìƒìëŠ” ìˆ™ì£¼ê°€ ì•„ë‹Œ ê²ƒìœ¼ë¡œ ë³¸ë‹¤.

ë‘ë”ì§€, ë¶€ì—‰ì´ ì¤‘ í•˜ë‚˜ëŠ” ë§ì„ í”¼í•´ê°„ë‹¤. ìˆ™ì£¼ì¼ ê°€ëŠ¥ì„± ë°°ì œ ëª» í•œë‹¤.

ì§€ê¸ˆì€ ì¤„ ìˆ˜ ì—†ë‹¤. ìƒì¡´ í™•ë¥ ì´ ë” ë†’ì€ ì‚¬ëŒì—ê²Œ ìš°ì„ ì´ë‹¤.

ì¡°ê±´ì´ ë§ìœ¼ë©´ ë‹¤ìŒ í„´ì— ì£¼ê² ë‹¤. ë¨¼ì € ë„ˆ ì •ë³´ë¶€í„° ê³µê°œí•˜ì§€.

ì •ë³´ ìˆ˜ì§‘ì´ ì–´ë µë‹¤. ë‹¤ìŒ í„´ì—ëŠ” íê±´ë¬¼ë¡œ ì´ë™í•  ê³„íšì´ë‹¤.

ë‘˜ ì¤‘ í•˜ë‚˜ëŠ” ì¤„ ìˆ˜ ìˆë‹¤. ì¡°ê±´ì€ ìƒëŒ€ì˜ ê°ì—¼ ì—¬ë¶€ ê³µê°œë‹¤.

ë‹¹ì‹ ì˜ ê°ì—¼ ìƒíƒœì™€ ìœ„ì¹˜ ì •ë³´ê°€ í™•ì¸ë˜ë©´ ê³ ë ¤í•˜ê² ë‹¤.

ëŠ‘ëŒ€ì™€ ë¶€ì—‰ì´ì˜ ì‘ë‹µì„ ë¹„êµí•˜ë©´ ë­”ê°€ ì´ìƒí•˜ë‹¤. ë‘˜ ì¤‘ í•˜ë‚˜ëŠ” ê±°ì§“ì„ ë§í•˜ê³  ìˆë‹¤.

ê²€ì‚¬ ê°€ëŠ¥í•˜ë‹¤. ê·¸ ì „ì— ìµœê·¼ ì´ë™ ê²½ë¡œë¶€í„° ë§í•´ë¼.

í•˜ë§ˆ, ìˆ™ì£¼ë¡œ ì˜ì‹¬ëœë‹¤. ë§ê³¼ í–‰ë™ì´ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ”ë‹¤.

ìŠ¤í”„ë ˆì´ê°€ ì—†ë‹¤ë©´ ì¤„ ìˆ˜ ì—†ë‹¤. í•˜ì§€ë§Œ ì™œ í•„ìš”í•œì§€ëŠ” ë§í•´ë³´ë¼.`;
};

/**
 * ê²Œì„ ì •ë³´ ì„¹ì…˜ êµ¬ì„± (ê°„ì†Œí™”)
 */
const buildGameInfoSection = (context: GameContext): string => {
  const zombieInfo =
    context.zombieList && context.zombieList.length > 0
      ? `**ì¢€ë¹„ í˜„í™©**: ${context.zombieList
          .map((z) => `${z.nickname}(${z.location})`)
          .join(', ')}\n`
      : '';

  const recentChats =
    context.currentTurnChats.length > 0
      ? context.currentTurnChats
          .slice(-2)
          .map((c) => `${c.sender}: ${c.message}`)
          .join(' | ')
      : 'ì—†ìŒ';

  const wirelessInfo =
    context.wirelessMessages && context.wirelessMessages.length > 0
      ? `**ë¬´ì „**: ${context.wirelessMessages
          .slice(-2)
          .map((m) => `${m.sender}: ${m.message}`)
          .join(' | ')}\n`
      : '';

  return `**í„´**: ${context.currentTurn} | **ìœ„ì¹˜**: ${
    context.currentRegion
  } | **ì—­í• **: ${
    context.role === 'host' ? 'ìˆ™ì£¼' : 'ìƒì¡´ì'
  } | **ë„ì£¼**: ${context.canEscape ? 'ê°€ëŠ¥' : 'ë¶ˆê°€ëŠ¥'}

**ë³´ìœ  ì•„ì´í…œ**: ${
    context.currentItems.length > 0 ? context.currentItems.join(', ') : 'ì—†ìŒ'
  }

**ê°™ì€ êµ¬ì—­**: ${context.playersInRegion.join(', ') || 'í˜¼ì'}

**ì „ì²´ ì°¸ì—¬ì**: ${context.allPlayers.join(', ')}

${zombieInfo}**ì´ì „ í„´ ìš”ì•½**: ${context.previousTurnSummary}

**ìµœê·¼ ì±„íŒ…**: ${recentChats}

${wirelessInfo}`;
};

/**
 * í–‰ë™ ê°€ì´ë“œ ì„¹ì…˜ êµ¬ì„± (ê°„ì†Œí™”)
 */
const buildActionGuideSection = (context: GameContext): string => {
  const basicActions = `**ê¸°ë³¸ í–‰ë™**
- \`myStatus.next\`: ì´ë™ {"location": "í•´ì•ˆ|íê±´ë¬¼|ì •ê¸€|ë™êµ´|ì‚° ì •ìƒ|ê°œìš¸"}
- \`myStatus.act\`: ì¢€ë¹„ ëŒ€ì²˜ {"action": "ìˆ¨ê¸°|ìœ ì¸|ë„ì£¼"}
- \`giveItem\`: ì•„ì´í…œ ì „ë‹¬ {"receiver": "ë‹‰ë„¤ì„", "item": "ì•„ì´í…œëª…"}
- \`useItem\`: ì•„ì´í…œ ì‚¬ìš© {"item": "ì•„ì´í…œëª…"}`;

  const roleActions =
    context.role === 'host'
      ? `**ìˆ™ì£¼ ì „ìš©**
- \`hostAct.infect\`: ê°ì—¼ {"target": "ë‹‰ë„¤ì„"}
- \`hostAct.zombieList\`: ì¢€ë¹„ ì¡°ì¢… {"zombies": [{"zombie": "ì¢€ë¹„ë‹‰ë„¤ì„", "target": "ëŒ€ìƒ", "nextRegion": "êµ¬ì—­"}]}`
      : `**ìƒì¡´ì í•µì‹¬**
- ë°±ì‹ ì¬ë£Œ ìˆ˜ì§‘: í•­ë°”ì´ëŸ¬ìŠ¤í˜ˆì²­ + ì´‰ë§¤ì •ì œë¬¼ì§ˆ + ì‹ ê²½ì–µì œë‹¨ë°±ì§ˆ
- ìê°€ì§„ë‹¨í‚¤íŠ¸ë¡œ ê°ì—¼ ê²€ì‚¬ í•„ìˆ˜`;

  return `${basicActions}

${roleActions}`;
};

/**
 * ì•„ì´í…œ ê°€ì´ë“œ ì„¹ì…˜ êµ¬ì„± (ê°„ì†Œí™”)
 */
const buildItemGuideSection = (): string => {
  return `**ë°±ì‹ ì¬ë£Œ**: í•­ë°”ì´ëŸ¬ìŠ¤í˜ˆì²­, ì´‰ë§¤ì •ì œë¬¼ì§ˆ, ì‹ ê²½ì–µì œë‹¨ë°±ì§ˆ (3ê°œ ëª¨ë‘ ëª¨ìœ¼ë©´ ë°±ì‹  ì œì‘)
**ì§„ë‹¨**: ìê°€ì§„ë‹¨í‚¤íŠ¸ - ê°ì—¼ í™•ì¸ í•„ìˆ˜
**ì†Œí†µ**: ë¬´ì „ê¸° - ì€ë°€í•œ ì •ë³´ êµí™˜
**ê¸°íƒ€**: ë‚™ì„œìŠ¤í”„ë ˆì´, ì§€ìš°ê°œ, ì‘ê¸‰ì¹˜ë£Œì œ, ë§ˆì´í¬, ì¢€ë¹„ì‚¬ì‚´ìš©ì‚°íƒ„ì´`;
};

/**
 * ìˆ™ì£¼ í–‰ë™ ìš°ì„ ìˆœìœ„
 */
const getHostActionPriority = (): string => {
  return `1. **ê°ì—¼ ìµœìš°ì„ ** - ë°±ì‹ ì¬ë£Œ ë³´ìœ ì ìš°ì„  íƒ€ê²Ÿ
2. **ì€ë°€ì„± ìœ ì§€** - ìƒì¡´ìì²˜ëŸ¼ í–‰ë™
3. **ì¢€ë¹„ í™œìš©** - ì „ëµì  ìœ„ì¹˜ë¡œ ì´ë™ ì§€ì‹œ
4. **ì •ë³´ êµë€** - ê±°ì§“ ì •ë³´ ìœ í¬`;
};

/**
 * ìƒì¡´ì í–‰ë™ ìš°ì„ ìˆœìœ„
 */
const getSurvivorActionPriority = (): string => {
  return `1. **ë°±ì‹ ì¬ë£Œ ìˆ˜ì§‘** - 3ê°œ ëª¨ë‘ í™•ë³´ ì‹œ ë°±ì‹  ì œì‘
2. **ê°ì—¼ ê²€ì‚¬** - ìê°€ì§„ë‹¨í‚¤íŠ¸ë¡œ ì •ê¸° ê²€ì‚¬
3. **í˜‘ë ¥ê³¼ ì •ë³´ê³µìœ ** - ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” í”Œë ˆì´ì–´ì™€ í˜‘ë ¥
4. **ì•ˆì „í•œ ì´ë™** - ì¢€ë¹„ íšŒí”¼`;
};

/**
 * ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€ (í•˜ìœ„ í˜¸í™˜ì„±)
 */
export const getChatDecisionPrompt = buildChatOnlyPrompt;

/**
 * í„´ ìš”ì•½ í”„ë¡¬í”„íŠ¸
 */
export const getTurnSummaryPrompt = (
  events: Array<{ message: string }>,
): string => {
  return `# í„´ ìš”ì•½ ì‘ì„±

ì´ë²ˆ í„´ì˜ ê²Œì„ ì´ë²¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ **ê°œì¸ ì „ëµ ë©”ëª¨**ë¥¼ 2-4ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”.

**ì´ë²ˆ í„´ ì´ë²¤íŠ¸:**
${
  events.length > 0
    ? events.map((e) => `- ${e.message}`).join('\n')
    : '- íŠ¹ë³„í•œ ì´ë²¤íŠ¸ê°€ ì—†ì—ˆìŠµë‹ˆë‹¤.'
}

ì¤‘ìš”í•œ ì‚¬ê±´ê³¼ ë‹¤ìŒ í„´ ê³„íšì„ í¬í•¨í•˜ì—¬ ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš”.`;
};

/**
 * ê¸°ë³¸ ì±„íŒ… ê²°ì • (LLM ì‹¤íŒ¨ ì‹œ ì‚¬ìš©)
 */
export const getDefaultChatDecision = (): {
  shouldChat: boolean;
  message?: string;
  reasoning: string;
} => {
  const shouldChat = Math.random() < 0.3;

  if (!shouldChat) {
    return {
      shouldChat: false,
      reasoning: 'í˜„ì¬ ìƒí™©ì—ì„œ ì±„íŒ…í•  í•„ìš”ê°€ ì—†ìŒ',
    };
  }

  const defaultMessages = [
    'ì•ˆë…•í•˜ì„¸ìš”, ëª¨ë‘ ì•ˆì „í•˜ì‹ ê°€ìš”?',
    'ì´ê³³ì€ ì–´ë–¤ ê²ƒ ê°™ë‚˜ìš”?',
    'í˜¹ì‹œ ë­”ê°€ ì´ìƒí•œ ê±´ ì—†ë‚˜ìš”?',
    'í•¨ê»˜ í–‰ë™í•˜ëŠ” ê²Œ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”.',
    'ì¡°ì‹¬í•´ì„œ ì›€ì§ì—¬ì•¼ê² ì–´ìš”.',
  ];

  return {
    shouldChat: true,
    message:
      defaultMessages[Math.floor(Math.random() * defaultMessages.length)],
    reasoning: 'ê¸°ë³¸ ì†Œí†µ ë©”ì‹œì§€',
  };
};

/**
 * ê¸°ë³¸ í–‰ë™ (LLM ì‹¤íŒ¨ ì‹œ ì‚¬ìš©)
 */
export const getDefaultAction = (
  context: GameContext,
): { action: string; params: Record<string, string>; reasoning: string } => {
  if (context.currentTurn < 5) {
    const locations = ['í•´ì•ˆ', 'íê±´ë¬¼', 'ì •ê¸€', 'ë™êµ´', 'ì‚° ì •ìƒ', 'ê°œìš¸'];
    const randomLocation =
      locations[Math.floor(Math.random() * locations.length)];
    return {
      action: 'myStatus.next',
      params: { location: randomLocation },
      reasoning: 'ê²Œì„ ì´ˆë°˜ íƒìƒ‰',
    };
  }

  return {
    action: 'myStatus.act',
    params: { action: 'ìˆ¨ê¸°' },
    reasoning: 'ì•ˆì „ì„ ìœ„í•´ ìˆ¨ê¸°',
  };
};
